<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Boarding Pass ‚Äî Flight Plan</title>
  <meta name="theme-color" content="#0b0f1a"/>

  <style>
    :root{
      --bg:#070A12;
      --fg:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --line:rgba(255,255,255,.14);

      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.10);

      --a:#7C5CFF;   /* purple */
      --b:#00E5FF;   /* cyan */
      --c:#FF3D7F;   /* pink */
      --ok:#33FF99;

      --shadow: 0 24px 90px rgba(0,0,0,.55);
      --r: 24px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--fg);
      background:
        radial-gradient(1200px 800px at 18% 20%, rgba(124,92,255,.18), transparent 60%),
        radial-gradient(900px 700px at 86% 30%, rgba(0,229,255,.14), transparent 55%),
        radial-gradient(900px 700px at 55% 95%, rgba(255,61,127,.10), transparent 55%),
        var(--bg);
      overflow:hidden;
    }

    /* animated mesh blobs */
    .mesh{position:fixed; inset:-20%; filter: blur(60px); opacity:.65; pointer-events:none;}
    .blob{
      position:absolute; width:44vmax; height:44vmax; border-radius:999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 55%),
        linear-gradient(135deg, rgba(124,92,255,.35), rgba(0,229,255,.18), rgba(255,61,127,.20));
      mix-blend-mode: screen;
      animation: drift 16s ease-in-out infinite;
    }
    .blob:nth-child(2){
      width:38vmax;height:38vmax; left:56%; top:10%;
      background: linear-gradient(135deg, rgba(0,229,255,.35), rgba(124,92,255,.16));
      animation-duration: 20s; opacity:.7;
    }
    .blob:nth-child(3){
      width:34vmax;height:34vmax; left:8%; top:58%;
      background: linear-gradient(135deg, rgba(255,61,127,.32), rgba(124,92,255,.14));
      animation-duration: 24s; opacity:.6;
    }
    @keyframes drift{
      0%{transform:translate3d(-4%,-2%,0) scale(1) rotate(0deg)}
      50%{transform:translate3d(4%,3%,0) scale(1.05) rotate(14deg)}
      100%{transform:translate3d(-4%,-2%,0) scale(1) rotate(0deg)}
    }

    .wrap{
      position:fixed; inset:0;
      display:grid;
      place-items:center;
      padding: 18px;
    }

    .card{
      width: min(920px, 100%);
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-radius: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      overflow:hidden;
    }

    .head{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(255,255,255,.14);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .passenger{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 260px;
    }
    .passenger .label{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
    }
    .passenger .name{
      font-family: var(--mono);
      font-weight: 900;
      letter-spacing: .14em;
      font-size: 18px;
      line-height: 1.1;
      text-transform: uppercase;
    }
    .passenger .nick{
      color: var(--muted);
      font-size: 13px;
      margin-top: -2px;
    }

    .meta{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .pill{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      text-transform: uppercase;
      padding: 9px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      white-space: nowrap;
    }

    .pill.ok{border-color: rgba(51,255,153,.26); color: rgba(51,255,153,.90)}
    .pill.wait{border-color: rgba(255,255,255,.18); color: rgba(255,255,255,.80)}

    .body{
      padding: 14px 16px 16px;
      display:grid;
      grid-template-columns: 1fr 320px;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 900px){
      .body{grid-template-columns: 1fr}
    }

    /* Flight plan list */
    .sectionTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius: 18px;
    }
    .sectionTitle b{font-size: 14px}
    .sectionTitle span{color: var(--muted); font-size: 12.5px}

    .itinerary{
      display:flex;
      flex-direction:column;
      gap: 10px;
      margin-top: 10px;
    }

    .stop{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      border-radius: 18px;
      padding: 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      position:relative;
      overflow:hidden;
    }
    .stop:hover{transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.22)}
    .stop .left{min-width: 0}
    .stop b{font-size: 14px; display:block}
    .stop .t{
      margin-top: 6px;
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      color: rgba(255,255,255,.72);
      text-transform: uppercase;
    }
    .stop .note{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    .stop .open{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      color: rgba(0,229,255,.85);
      white-space:nowrap;
      opacity:.95;
      padding-top: 2px;
    }

    /* Right side (links + check-in) */
    .side{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius: 22px;
      padding: 12px;
      overflow:hidden;
    }

    .miniRow{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .linkBtn{
      display:inline-flex; align-items:center; gap:8px;
      text-decoration:none;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      font-weight: 900;
      font-size: 13px;
      transition: transform .08s ease, background .2s ease;
    }
    .linkBtn:hover{transform: translateY(-1px); background: rgba(255,255,255,.07)}
    .ico{font-family:var(--mono); opacity:.85}

    /* Big CHECK-IN block (at end) */
    .checkin{
      margin-top: 14px;
      border:1px solid rgba(255,255,255,.16);
      border-radius: 22px;
      background:
        radial-gradient(600px 220px at 20% 0%, rgba(124,92,255,.20), transparent 60%),
        radial-gradient(600px 220px at 80% 20%, rgba(0,229,255,.16), transparent 60%),
        rgba(0,0,0,.16);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }

    .barcode{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      border-radius: 18px;
      padding: 12px;
      position:relative;
      overflow:hidden;
    }
    .bars{
      height: 54px;
      display:flex;
      gap: 2px;
      align-items:flex-end;
      opacity:.9;
    }
    .bar{width:3px; background: rgba(255,255,255,.86); border-radius: 2px; opacity:.9;}
    .barcodeMeta{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color: rgba(255,255,255,.78);
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.16em;
      text-transform: uppercase;
    }
    .scanLine{
      position:absolute;
      left:-20%;
      width: 140%;
      height: 3px;
      top: -30px;
      background: linear-gradient(90deg, transparent, rgba(0,229,255,.75), rgba(255,255,255,.85), rgba(124,92,255,.75), transparent);
      opacity:0;
    }
    .barcode.scanning .scanLine{
      opacity:1;
      animation: scan 1.05s cubic-bezier(.2,.8,.2,1) 1;
    }
    @keyframes scan{ 0%{ top:-30px } 100%{ top: 95px } }

    .stamp{
      position:absolute;
      right: 14px; top: 14px;
      transform: rotate(-10deg) scale(.92);
      border:2px solid rgba(51,255,153,.75);
      color: rgba(51,255,153,.90);
      background: rgba(0,0,0,.25);
      padding: 8px 10px;
      border-radius: 14px;
      font-family: var(--mono);
      letter-spacing:.14em;
      text-transform: uppercase;
      font-weight: 900;
      opacity:0;
      pointer-events:none;
      box-shadow: 0 14px 40px rgba(51,255,153,.12);
    }
    .checkin.checked .stamp{
      opacity:1;
      animation: pop .22s ease-out 1;
    }
    @keyframes pop{
      0%{ transform: rotate(-10deg) scale(.7); opacity:.2}
      100%{ transform: rotate(-10deg) scale(.92); opacity:1}
    }

    .bigBtn{
      width: 100%;
      margin-top: 10px;
      border: none;
      cursor:pointer;
      padding: 14px 14px;
      border-radius: 18px;
      font-weight: 950;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: #021018;
      background: linear-gradient(135deg, var(--a), var(--b));
      box-shadow: 0 18px 60px rgba(124,92,255,.22);
      transition: transform .08s ease, filter .2s ease;
    }
    .bigBtn:hover{transform: translateY(-1px); filter: brightness(1.05)}
    .bigBtn:disabled{opacity:.55; cursor:default; transform:none}

    .smallBtn{
      width:100%;
      margin-top: 10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      padding: 11px 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 900;
    }

    /* HUB (lista de pessoas) */
    .hub{
      padding: 16px;
    }
    .hubTitle{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom: 14px;
    }
    .hubTitle h1{margin:0; font-size:18px}
    .hubTitle p{margin:0; color:var(--muted); font-size:13px}

    .gridHub{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media (max-width: 900px){ .gridHub{grid-template-columns: 1fr} }

    .personCard{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius: 22px;
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .personCard .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .personCard .nm{
      font-weight: 950;
      font-size: 14px;
      line-height: 1.2;
    }
    .personCard .id{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      color: rgba(255,255,255,.72);
      text-transform: uppercase;
    }
    .rowBtns{display:flex; gap:10px; flex-wrap:wrap}
    .ghostBtn{
      flex:1 1 auto;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      padding: 10px 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 900;
    }
    .openBtn{
      flex:1 1 auto;
      border:none;
      background: linear-gradient(135deg, var(--a), var(--b));
      color:#021018;
      padding: 10px 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 950;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%; transform: translateX(-50%);
      bottom: 14px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.34);
      color: rgba(255,255,255,.85);
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 30;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(-4px)}

    /* Print: imprime s√≥ o modo PASS (se quiseres imprimir 1 bilhete) */
    @media print{
      body{overflow:visible; background:#fff; color:#111}
      .mesh,.toast{display:none !important}
      .wrap{position:static; padding:0}
      .card{box-shadow:none; border:1px solid #ddd; background:#fff}
      .pill,.sectionTitle,.stop,.side,.barcode{border-color:#ddd; background:#fff}
      .bar{background:#111}
      .barcodeMeta,.passenger .label{color:#111}
      .bigBtn,.smallBtn{display:none !important}
    }
  </style>
</head>

<body>
  <div class="mesh" aria-hidden="true">
    <div class="blob" style="left:-6%; top:-8%"></div>
    <div class="blob"></div>
    <div class="blob"></div>
  </div>

  <div class="wrap">
    <div class="card" id="app"></div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== DADOS =====
    const PASSENGERS = [
      { id:"belinha-oliveira", title:"MS", first:"Belinha", last:"Oliveira", nick:"" },
      { id:"candido-srx-xavier", title:"MR", first:"Candido", last:"Xavier", nick:"Sr.X" },
      { id:"pedrinho-animalaria-oliveira", title:"MR", first:"Pedrinho", last:"Oliveira", nick:"Animal√°ria" },
      { id:"maria-barriguitas-oliveira", title:"MS", first:"Maria", last:"Oliveira", nick:"Barriguitas" },
      { id:"miguel-roadrunner-santos", title:"MR", first:"Miguel", last:"Santos", nick:"RoadRunner" },
      { id:"joana-pipa-luis", title:"MS", first:"Joana", last:"Lu√≠s", nick:"Pipa" },
    ];

    const TRIP = {
      dateLabel: "data a combinar",
      flight: "QUAKE1755",
      gate: "BEL√âM",
      from: "LIS",
      to: "BLM",
      links: {
        meet:  "https://www.google.com/maps/search/?api=1&query=Bel%C3%A9m%20Lisboa",
        museum:"https://www.google.com/maps/search/?api=1&query=Quake%20Museu%20do%20Terramoto%20de%20Lisboa",
        nata:  "https://www.google.com/maps/search/?api=1&query=Past%C3%A9is%20de%20Bel%C3%A9m",
        tower: "https://www.google.com/maps/search/?api=1&query=Torre%20de%20Bel%C3%A9m",
        spritz:"https://www.google.com/maps/search/?api=1&query=bar%20Bel%C3%A9m%20Lisboa%20spritz"
      },
      itinerary: [
        { time:"11:00", title:"Encontro", note:"Ponto de encontro em Bel√©m", urlKey:"meet" },
        { time:"11:30", title:"Museu do Terramoto", note:"Entrada / experi√™ncia", urlKey:"museum" },
        { time:"13:00", title:"Pastel de nata", note:"Past√©is de Bel√©m (buff oficial)", urlKey:"nata" },
        { time:"16:30", title:"P√¥r-do-sol", note:"Torre de Bel√©m + passeio", urlKey:"tower" },
        { time:"17:00", title:"Spritz", note:"Recompensa final ü•Ç", urlKey:"spritz" },
      ]
    };
    // =================

    const $ = (s)=>document.querySelector(s);
    const app = $("#app");
    const toast = $("#toast");

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
    }

    function airlineName(p){
      // Estilo avi√£o: TITLE LAST/FIRST
      const last = (p.last || "").toUpperCase();
      const first = (p.first || "").toUpperCase();
      const title = (p.title || "").toUpperCase();
      return `${title} ${last}/${first}`.trim();
    }

    function nickLine(p){
      if(!p.nick) return "";
      return `‚Äú${p.nick}‚Äù`;
    }

    function makeBars(seed){
      let x = seed;
      const rand = ()=> (x = (x*9301 + 49297) % 233280) / 233280;
      const bars = [];
      for(let i=0;i<58;i++){
        const h = 16 + Math.floor(rand()*38);
        const w = rand() < 0.28 ? 2 : 3;
        const op = 0.60 + rand()*0.40;
        bars.push({h,w,op});
      }
      return bars;
    }

    function passView(p){
      const seed = p.id.length*1337 + (p.first?.length||0)*97 + (p.last?.length||0)*31;
      const bars = makeBars(seed).map(b=>`
        <div class="bar" style="height:${b.h}px;width:${b.w}px;opacity:${b.op}"></div>
      `).join("");

      const stops = TRIP.itinerary.map(s=>{
        const url = TRIP.links[s.urlKey];
        return `
          <div class="stop" data-url="${url}">
            <div class="left">
              <b>${s.title}</b>
              <div class="t">${s.time}</div>
              <div class="note">${s.note}</div>
            </div>
            <div class="open">ABRIR ‚Üó</div>
          </div>
        `;
      }).join("");

      return `
        <div class="head">
          <div class="passenger">
            <div class="label">Passenger</div>
            <div class="name">${airlineName(p)}</div>
            <div class="nick">${nickLine(p)}</div>
          </div>

          <div class="meta">
            <div class="pill wait" id="statusPill">READY</div>
            <div class="pill">FLIGHT ${TRIP.flight}</div>
            <div class="pill">${TRIP.from}‚Üí${TRIP.to}</div>
            <div class="pill">DATE ${TRIP.dateLabel}</div>
          </div>
        </div>

        <div class="body">
          <div>
            <div class="sectionTitle">
              <b>üó∫Ô∏è Flight plan (roteiro)</b>
              <span>clica para abrir no Maps</span>
            </div>

            <div class="itinerary">${stops}</div>
          </div>

          <div class="side">
            <div class="sectionTitle" style="margin-bottom:10px">
              <b>Links r√°pidos</b>
              <span>Bel√©m</span>
            </div>

            <div class="miniRow">
              <a class="linkBtn" target="_blank" rel="noopener" href="${TRIP.links.meet}">
                <span class="ico">MAP</span> Encontro
              </a>
              <a class="linkBtn" target="_blank" rel="noopener" href="${TRIP.links.museum}">
                <span class="ico">MAP</span> Museu
              </a>
              <a class="linkBtn" target="_blank" rel="noopener" href="${TRIP.links.tower}">
                <span class="ico">MAP</span> Torre
              </a>
            </div>

            <div class="checkin" id="checkinBox">
              <div class="stamp" id="stamp">CHECKED-IN</div>

              <div class="barcode" id="barcode">
                <div class="scanLine"></div>
                <div class="bars" aria-hidden="true">${bars}</div>
                <div class="barcodeMeta">
                  <span>${TRIP.flight} ‚Ä¢ ${TRIP.gate}</span>
                  <span>${p.id.toUpperCase()}</span>
                </div>
              </div>

              <button class="bigBtn" id="btnCheckIn">CHECK-IN</button>
              <button class="smallBtn" id="btnCopyLink">Copiar link deste bilhete</button>
            </div>
          </div>
        </div>
      `;
    }

    function hubView(){
      const base = location.origin + location.pathname; // URL atual sem query
      const cards = PASSENGERS.map(p=>{
        const link = `${base}?p=${encodeURIComponent(p.id)}`;
        const pretty = `${p.first} ${p.nick ? `‚Äú${p.nick}‚Äù ` : ""}${p.last}`.trim();
        return `
          <div class="personCard">
            <div class="top">
              <div>
                <div class="nm">${pretty}</div>
                <div class="id">${airlineName(p)}</div>
              </div>
              <div class="pill" style="opacity:.9">${p.id}</div>
            </div>
            <div class="rowBtns">
              <button class="ghostBtn" data-copy="${link}">Copiar link</button>
              <button class="openBtn" data-open="${link}">Abrir</button>
            </div>
          </div>
        `;
      }).join("");

      return `
        <div class="hub">
          <div class="hubTitle">
            <div>
              <h1>üì® Links personalizados (um por pessoa)</h1>
              <p>Abre um, copia o link e envia no WhatsApp. Cada link vai direto para o boarding pass dessa pessoa.</p>
            </div>
            <div class="pill">DATE ${TRIP.dateLabel}</div>
          </div>

          <div class="gridHub">${cards}</div>
        </div>
      `;
    }

    function getPassengerFromQuery(){
      const sp = new URLSearchParams(location.search);
      const id = sp.get("p");
      if(!id) return null;
      return PASSENGERS.find(x => x.id === id) || null;
    }

    function wireCommon(){
      // stop clicks
      app.querySelectorAll(".stop").forEach(el=>{
        el.addEventListener("click", ()=>{
          const url = el.getAttribute("data-url");
          window.open(url, "_blank", "noopener");
        });
      });
    }

    function wirePass(p){
      const btn = $("#btnCheckIn");
      const barcode = $("#barcode");
      const box = $("#checkinBox");
      const pill = $("#statusPill");

      btn.addEventListener("click", ()=>{
        if(box.classList.contains("checked")) return;

        barcode.classList.remove("scanning");
        void barcode.offsetWidth;
        barcode.classList.add("scanning");

        pill.textContent = "SCANNING";
        pill.classList.remove("wait");
        pill.style.borderColor = "rgba(0,229,255,.28)";
        pill.style.color = "rgba(0,229,255,.90)";

        setTimeout(()=>{
          box.classList.add("checked");
          pill.textContent = "CHECKED-IN";
          pill.classList.add("ok");
          pill.style.borderColor = "rgba(51,255,153,.26)";
          pill.style.color = "rgba(51,255,153,.90)";
          btn.disabled = true;
          try{ navigator.vibrate?.(18); }catch(e){}
          showToast("Bilhete carimbado ‚úÖ");
        }, 850);
      });

      $("#btnCopyLink").addEventListener("click", async ()=>{
        const base = location.origin + location.pathname;
        const link = `${base}?p=${encodeURIComponent(p.id)}`;
        try{
          await navigator.clipboard.writeText(link);
          showToast("Link copiado ‚úÖ");
        }catch(e){
          showToast("N√£o deu para copiar (browser).");
        }
      });
    }

    function wireHub(){
      app.querySelectorAll("[data-copy]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const link = btn.getAttribute("data-copy");
          try{
            await navigator.clipboard.writeText(link);
            showToast("Link copiado ‚úÖ");
          }catch(e){
            showToast("N√£o deu para copiar (browser).");
          }
        });
      });
      app.querySelectorAll("[data-open]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const link = btn.getAttribute("data-open");
          window.open(link, "_blank", "noopener");
        });
      });
    }

    // Render
    const passenger = getPassengerFromQuery();
    if(passenger){
      app.innerHTML = passView(passenger);
      wireCommon();
      wirePass(passenger);
    }else{
      app.innerHTML = hubView();
      wireHub();
    }
  </script>
</body>
</html>
