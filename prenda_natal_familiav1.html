<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Boarding Pass ‚Äî Flight Plan</title>
  <meta name="theme-color" content="#0b0f1a"/>

  <style>
    :root{
      --bg:#070A12;
      --fg:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --line:rgba(255,255,255,.14);
      --a:#7C5CFF; --b:#00E5FF; --c:#FF3D7F; --ok:#33FF99;
      --shadow: 0 24px 90px rgba(0,0,0,.55);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--fg);
      background:
        radial-gradient(1200px 800px at 18% 20%, rgba(124,92,255,.18), transparent 60%),
        radial-gradient(900px 700px at 86% 30%, rgba(0,229,255,.14), transparent 55%),
        radial-gradient(900px 700px at 55% 95%, rgba(255,61,127,.10), transparent 55%),
        var(--bg);
      overflow:auto;
    }

    /* blobs */
    .mesh{position:fixed; inset:-20%; filter: blur(60px); opacity:.65; pointer-events:none;}
    .blob{position:absolute; width:44vmax; height:44vmax; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 55%),
                  linear-gradient(135deg, rgba(124,92,255,.35), rgba(0,229,255,.18), rgba(255,61,127,.20));
      mix-blend-mode: screen; animation: drift 16s ease-in-out infinite;
    }
    .blob:nth-child(2){width:38vmax;height:38vmax; left:56%; top:10%;
      background: linear-gradient(135deg, rgba(0,229,255,.35), rgba(124,92,255,.16));
      animation-duration: 20s; opacity:.7;
    }
    .blob:nth-child(3){width:34vmax;height:34vmax; left:8%; top:58%;
      background: linear-gradient(135deg, rgba(255,61,127,.32), rgba(124,92,255,.14));
      animation-duration: 24s; opacity:.6;
    }
    @keyframes drift{
      0%{transform:translate3d(-4%,-2%,0) scale(1) rotate(0deg)}
      50%{transform:translate3d(4%,3%,0) scale(1.05) rotate(14deg)}
      100%{transform:translate3d(-4%,-2%,0) scale(1) rotate(0deg)}
    }

    .wrap{
      min-height: 100dvh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      padding-bottom: calc(18px + env(safe-area-inset-bottom));
    }
    @media (max-width: 900px){
      .wrap{align-items:flex-start; padding: 12px; padding-bottom: calc(12px + env(safe-area-inset-bottom));}
    }

    .card{
      width: min(980px, 100%);
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-radius: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      overflow:hidden;
    }

    .head{
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,.14);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }

    .passenger{display:flex; flex-direction:column; gap:6px; min-width: 240px; max-width: 100%;}
    .passenger .label{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
    }
    .passenger .name{
      font-family: var(--mono);
      font-weight: 900;
      letter-spacing: .12em;
      font-size: clamp(14px, 4.4vw, 18px);
      line-height: 1.15;
      text-transform: uppercase;
      overflow-wrap:anywhere;
      word-break: break-word;
    }
    .passenger .nick{color: var(--muted); font-size: 13px; margin-top:-2px}

    .meta{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end;
      max-width:100%;
    }
    @media (max-width: 520px){
      .meta{
        width:100%;
        flex-wrap: nowrap;
        overflow:auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 2px;
      }
      .meta::-webkit-scrollbar{display:none}
    }

    .pill{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      text-transform: uppercase;
      padding: 9px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      white-space: nowrap;
      flex: 0 0 auto;
    }
    .pill.ok{border-color: rgba(51,255,153,.26); color: rgba(51,255,153,.90)}
    .pill.wait{border-color: rgba(255,255,255,.18); color: rgba(255,255,255,.80)}

    .body{
      padding: 14px;
      display:grid;
      grid-template-columns: 1fr 340px;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 900px){
      .body{grid-template-columns: 1fr}
    }

    .sectionTitle{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 10px 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius: 18px;
    }
    .sectionTitle b{font-size: 14px}
    .sectionTitle span{color: var(--muted); font-size: 12.5px}

    /* progress */
    .progress{
      margin-top: 10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.10);
      border-radius: 18px;
      padding: 10px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .barWrap{
      flex:1;
      height: 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      overflow:hidden;
    }
    .barFill{
      height:100%;
      width:0%;
      background: linear-gradient(135deg, var(--a), var(--b));
      border-radius: 999px;
      transition: width .35s ease;
    }
    .progTxt{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      color: rgba(255,255,255,.72);
      white-space:nowrap;
    }

    .itinerary{display:flex; flex-direction:column; gap: 10px; margin-top: 10px}

    .stop{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      border-radius: 18px;
      padding: 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      position:relative;
      overflow:hidden;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .stop:hover{transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.22)}

    .stop .left{min-width: 0}
    .stop b{font-size: 14px; display:block}
    .stop .t{
      margin-top: 6px;
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      color: rgba(255,255,255,.72);
      text-transform: uppercase;
    }
    .stop .note{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    /* REVEAL overlay (step locked) */
    .stop.lockedStep .note{
      filter: blur(9px);
      opacity: .45;
      user-select:none;
    }
    .stop.lockedStep .openRow{opacity:.55; pointer-events:none}
    .revealOverlay{
      position:absolute; inset:0;
      background:
        radial-gradient(500px 160px at 20% 10%, rgba(124,92,255,.16), transparent 55%),
        radial-gradient(500px 160px at 80% 20%, rgba(0,229,255,.12), transparent 55%),
        rgba(0,0,0,.22);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px;
      pointer-events:auto;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
    }
    .revealOverlay .hintTxt{
      min-width: 0;
      color: rgba(255,255,255,.78);
      font-size: 13px;
      line-height: 1.25;
    }
    .revealOverlay .hintTxt b{color: rgba(255,255,255,.92)}
    .revealBtn{
      flex: 0 0 auto;
      border:none;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 950;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: #021018;
      background: linear-gradient(135deg, var(--a), var(--b));
      box-shadow: 0 14px 45px rgba(124,92,255,.22);
      transition: transform .08s ease, filter .2s ease;
      white-space:nowrap;
    }
    .revealBtn:hover{transform: translateY(-1px); filter: brightness(1.05)}

    .openRow{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap: 8px;
      flex: 0 0 auto;
    }
    .open{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      color: rgba(0,229,255,.85);
      white-space:nowrap;
      opacity:.95;
      padding-top: 2px;
      cursor:pointer;
      user-select:none;
    }
    .openBtnMini{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      padding: 8px 10px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 900;
      font-size: 12px;
      white-space:nowrap;
    }

    /* completed */
    .stop.done{
      border-color: rgba(51,255,153,.22);
      background: linear-gradient(135deg, rgba(51,255,153,.10), rgba(255,255,255,.04));
    }
    .stop.done .open{color: rgba(51,255,153,.90)}
    .stop.done::after{
      content:"‚úì";
      position:absolute;
      right: 14px; bottom: 10px;
      width: 28px; height: 28px;
      border-radius: 999px;
      display:grid; place-items:center;
      border:1px solid rgba(51,255,153,.26);
      background: rgba(0,0,0,.18);
      color: rgba(51,255,153,.90);
      font-weight: 900;
    }

    .side{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius: 22px;
      padding: 12px;
      overflow:hidden;
    }

    .miniRow{display:flex; gap: 10px; flex-wrap:wrap; margin-top: 10px}
    .linkBtn{
      display:inline-flex; align-items:center; gap:8px;
      text-decoration:none;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      font-weight: 900;
      font-size: 13px;
      transition: transform .08s ease, background .2s ease;
    }
    .linkBtn:hover{transform: translateY(-1px); background: rgba(255,255,255,.07)}
    .ico{font-family:var(--mono); opacity:.85}

    .checkin{
      margin-top: 14px;
      border:1px solid rgba(255,255,255,.16);
      border-radius: 22px;
      background:
        radial-gradient(600px 220px at 20% 0%, rgba(124,92,255,.20), transparent 60%),
        radial-gradient(600px 220px at 80% 20%, rgba(0,229,255,.16), transparent 60%),
        rgba(0,0,0,.16);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }

    .barcode{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      border-radius: 18px;
      padding: 12px;
      position:relative;
      overflow:hidden;
    }
    .bars{height: 54px; display:flex; gap: 2px; align-items:flex-end; opacity:.9;}
    .bar{width:3px; background: rgba(255,255,255,.86); border-radius: 2px; opacity:.9;}
    .barcodeMeta{
      margin-top: 10px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      color: rgba(255,255,255,.78);
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.16em;
      text-transform: uppercase;
    }
    .scanLine{
      position:absolute; left:-20%;
      width: 140%; height: 3px; top: -30px;
      background: linear-gradient(90deg, transparent, rgba(0,229,255,.75), rgba(255,255,255,.85), rgba(124,92,255,.75), transparent);
      opacity:0;
    }
    .barcode.scanning .scanLine{opacity:1; animation: scan 1.05s cubic-bezier(.2,.8,.2,1) 1;}
    @keyframes scan{ 0%{ top:-30px } 100%{ top: 95px } }

    .stamp{
      position:absolute; right: 14px; top: 14px;
      transform: rotate(-10deg) scale(.92);
      border:2px solid rgba(51,255,153,.75);
      color: rgba(51,255,153,.90);
      background: rgba(0,0,0,.25);
      padding: 8px 10px;
      border-radius: 14px;
      font-family: var(--mono);
      letter-spacing:.14em;
      text-transform: uppercase;
      font-weight: 900;
      opacity:0;
      pointer-events:none;
      box-shadow: 0 14px 40px rgba(51,255,153,.12);
    }
    .checkin.checked .stamp{opacity:1; animation: pop .22s ease-out 1;}
    @keyframes pop{ 0%{ transform: rotate(-10deg) scale(.7); opacity:.2} 100%{ transform: rotate(-10deg) scale(.92); opacity:1} }

    .bigBtn{
      width: 100%;
      margin-top: 10px;
      border: none;
      cursor:pointer;
      padding: 14px 14px;
      border-radius: 18px;
      font-weight: 950;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: #021018;
      background: linear-gradient(135deg, var(--a), var(--b));
      box-shadow: 0 18px 60px rgba(124,92,255,.22);
      transition: transform .08s ease, filter .2s ease;
    }
    .bigBtn:hover{transform: translateY(-1px); filter: brightness(1.05)}
    .bigBtn:disabled{opacity:.55; cursor:default; transform:none}

    .smallBtn{
      width:100%;
      margin-top: 10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      padding: 11px 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 900;
    }

    /* HUB */
    .hub{padding: 16px}
    .hubTitle{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom: 14px}
    .hubTitle h1{margin:0; font-size:18px}
    .hubTitle p{margin:0; color:var(--muted); font-size:13px}
    .gridHub{display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px}
    @media (max-width: 900px){ .gridHub{grid-template-columns: 1fr} }

    .personCard{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius: 22px;
      padding: 12px;
      display:flex; flex-direction:column; gap: 10px;
    }
    .personCard .top{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
    .personCard .nm{font-weight: 950; font-size: 14px; line-height: 1.2}
    .personCard .id{font-family: var(--mono); font-size: 11px; letter-spacing:.14em; color: rgba(255,255,255,.72); text-transform: uppercase}
    .rowBtns{display:flex; gap:10px; flex-wrap:wrap}
    .ghostBtn{
      flex:1 1 auto;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      padding: 10px 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 900;
    }
    .openBtn{
      flex:1 1 auto;
      border:none;
      background: linear-gradient(135deg, var(--a), var(--b));
      color:#021018;
      padding: 10px 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 950;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%; transform: translateX(-50%);
      bottom: 14px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.34);
      color: rgba(255,255,255,.85);
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 30;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(-4px)}

    /* Easter egg modal */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modal{
      width: min(520px, 100%);
      border:1px solid rgba(255,255,255,.18);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.22));
      box-shadow: 0 30px 120px rgba(0,0,0,.6);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      padding: 14px;
    }
    .modal h3{margin:0 0 8px; font-size: 16px}
    .modal p{margin:0; color: rgba(255,255,255,.80); line-height:1.35}
    .modal .cta{
      margin-top: 12px;
      display:flex;
      gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .modal button{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--fg);
      padding: 10px 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 950;
    }
    .modal button.primary{
      border:none;
      background: linear-gradient(135deg, var(--a), var(--b));
      color:#021018;
    }
  </style>
</head>

<body>
  <div class="mesh" aria-hidden="true">
    <div class="blob" style="left:-6%; top:-8%"></div>
    <div class="blob"></div>
    <div class="blob"></div>
  </div>

  <div class="wrap">
    <div class="card" id="app"></div>
  </div>

  <div class="toast" id="toast"></div>

  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>üéÅ Prenda desbloqueada</h3>
      <p id="eggText"></p>
      <div class="cta">
        <button id="closeEgg">Fechar</button>
        <button class="primary" id="shareEgg">Partilhar</button>
      </div>
    </div>
  </div>

  <script>
    // ===== DADOS =====
    const PASSENGERS = [
      { id:"belinha-oliveira", title:"MS", first:"Belinha", last:"Oliveira", nick:"" },
      { id:"candido-srx-xavier", title:"MR", first:"Candido", last:"Xavier", nick:"Sr.X" },
      { id:"pedrinho-animalaria-oliveira", title:"MR", first:"Pedrinho", last:"Oliveira", nick:"Animal√°ria" },
      { id:"maria-barriguitas-oliveira", title:"MS", first:"Maria", last:"Oliveira", nick:"Barriguitas" },
      { id:"miguel-roadrunner-santos", title:"MR", first:"Miguel", last:"Santos", nick:"RoadRunner" },
      { id:"joana-pipa-luis", title:"MS", first:"Joana", last:"Lu√≠s", nick:"Pipa" },
    ];

    const TRIP = {
      dateLabel: "data a combinar",
      flight: "QUAKE1755",
      gate: "BEL√âM",
      from: "LIS",
      to: "BLM",
      links: {
        meet:  "https://www.google.com/maps/search/?api=1&query=Bel%C3%A9m%20Lisboa",
        museum:"https://www.google.com/maps/search/?api=1&query=Quake%20Museu%20do%20Terramoto%20de%20Lisboa",
        nata:  "https://www.google.com/maps/search/?api=1&query=Past%C3%A9is%20de%20Bel%C3%A9m",
        tower: "https://www.google.com/maps/search/?api=1&query=Torre%20de%20Bel%C3%A9m",
        spritz:"https://www.google.com/maps/search/?api=1&query=bar%20Bel%C3%A9m%20Lisboa%20spritz"
      },
      itinerary: [
        { key:"meet",   time:"11:00", title:"Encontro",          note:"Ponto de encontro em Bel√©m",              urlKey:"meet" },
        { key:"museum", time:"11:30", title:"Museu do Terramoto",note:"Entrada / experi√™ncia",                  urlKey:"museum" },
        { key:"nata",   time:"13:00", title:"Pastel de nata",    note:"Past√©is de Bel√©m (buff oficial)",        urlKey:"nata" },
        { key:"tower",  time:"16:30", title:"P√¥r-do-sol",        note:"Torre de Bel√©m + passeio",               urlKey:"tower" },
        { key:"spritz", time:"17:00", title:"Spritz",            note:"Recompensa final ü•Ç",                     urlKey:"spritz" },
      ],
      easterEgg: "Prenda de natal, voc√™s aturarem-me o dia todoüòà. Adoro-vos"
    };
    // =================

    const $ = (s)=>document.querySelector(s);
    const app = $("#app");
    const toast = $("#toast");
    const modalBack = $("#modalBack");
    const eggText = $("#eggText");
    const closeEgg = $("#closeEgg");
    const shareEgg = $("#shareEgg");

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
    }

    function airlineName(p){
      const last = (p.last || "").toUpperCase();
      const first = (p.first || "").toUpperCase();
      const title = (p.title || "").toUpperCase();
      return `${title} ${last}/${first}`.trim();
    }
    function nickLine(p){ return p.nick ? `‚Äú${p.nick}‚Äù` : ""; }

    function makeBars(seed){
      let x = seed;
      const rand = ()=> (x = (x*9301 + 49297) % 233280) / 233280;
      const bars = [];
      for(let i=0;i<58;i++){
        const h = 16 + Math.floor(rand()*38);
        const w = rand() < 0.28 ? 2 : 3;
        const op = 0.60 + rand()*0.40;
        bars.push({h,w,op});
      }
      return bars;
    }

    function passView(p){
      const seed = p.id.length*1337 + (p.first?.length||0)*97 + (p.last?.length||0)*31;
      const bars = makeBars(seed).map(b=>`
        <div class="bar" style="height:${b.h}px;width:${b.w}px;opacity:${b.op}"></div>
      `).join("");

      const stops = TRIP.itinerary.map(s=>{
        const url = TRIP.links[s.urlKey];
        return `
          <div class="stop lockedStep" data-key="${s.key}" data-url="${url}">
            <div class="left">
              <b>${s.title}</b>
              <div class="t">${s.time}</div>
              <div class="note">${s.note}</div>
            </div>

            <div class="openRow">
              <div class="open">ABRIR ‚Üó</div>
              <button class="openBtnMini" data-open>ABRIR</button>
            </div>

            <div class="revealOverlay" data-reveal>
              <div class="hintTxt">
                <b>Cart√£o selado.</b><br/>
                Carrega em <b>REVELAR</b> para desbloquear este passo.
              </div>
              <button class="revealBtn" data-reveal-btn>REVELAR</button>
            </div>
          </div>
        `;
      }).join("");

      return `
        <div class="head">
          <div class="passenger">
            <div class="label">Passenger</div>
            <div class="name">${airlineName(p)}</div>
            <div class="nick">${nickLine(p)}</div>
          </div>

          <div class="meta">
            <div class="pill wait" id="statusPill">READY</div>
            <div class="pill">FLIGHT ${TRIP.flight}</div>
            <div class="pill">${TRIP.from}‚Üí${TRIP.to}</div>
            <div class="pill">DATE ${TRIP.dateLabel}</div>
          </div>
        </div>

        <div class="body">
          <div>
            <div class="sectionTitle">
              <b>üó∫Ô∏è Flight plan (roteiro)</b>
              <span>revela cada passo (1 a 1)</span>
            </div>

            <div class="progress">
              <div class="barWrap"><div class="barFill" id="barFill"></div></div>
              <div class="progTxt" id="progTxt">0/5</div>
            </div>

            <div class="itinerary" id="itinerary">${stops}</div>
          </div>

          <div class="side">
            <div class="sectionTitle" style="margin-bottom:10px">
              <b>Links r√°pidos</b>
              <span>Bel√©m</span>
            </div>

            <div class="miniRow">
              <a class="linkBtn" target="_blank" rel="noopener" href="${TRIP.links.meet}">
                <span class="ico">MAP</span> Encontro
              </a>
              <a class="linkBtn" target="_blank" rel="noopener" href="${TRIP.links.museum}">
                <span class="ico">MAP</span> Museu
              </a>
              <a class="linkBtn" target="_blank" rel="noopener" href="${TRIP.links.tower}">
                <span class="ico">MAP</span> Torre
              </a>
            </div>

            <div class="checkin" id="checkinBox">
              <div class="stamp">CHECKED-IN</div>

              <div class="barcode" id="barcode">
                <div class="scanLine"></div>
                <div class="bars" aria-hidden="true">${bars}</div>
                <div class="barcodeMeta">
                  <span>${TRIP.flight} ‚Ä¢ ${TRIP.gate}</span>
                  <span>${p.id.toUpperCase()}</span>
                </div>
              </div>

              <button class="bigBtn" id="btnCheckIn">CHECK-IN (iniciar miss√£o)</button>
              <button class="smallBtn" id="btnCopyLink">Copiar link deste bilhete</button>
            </div>
          </div>
        </div>
      `;
    }

    function hubView(){
      const base = location.origin + location.pathname;
      const cards = PASSENGERS.map(p=>{
        const link = `${base}?p=${encodeURIComponent(p.id)}`;
        const pretty = `${p.first} ${p.nick ? `‚Äú${p.nick}‚Äù ` : ""}${p.last}`.trim();
        return `
          <div class="personCard">
            <div class="top">
              <div>
                <div class="nm">${pretty}</div>
                <div class="id">${airlineName(p)}</div>
              </div>
              <div class="pill" style="opacity:.9">${p.id}</div>
            </div>
            <div class="rowBtns">
              <button class="ghostBtn" data-copy="${link}">Copiar link</button>
              <button class="openBtn" data-open="${link}">Abrir</button>
            </div>
          </div>
        `;
      }).join("");

      return `
        <div class="hub">
          <div class="hubTitle">
            <div>
              <h1>üì® Links personalizados (um por pessoa)</h1>
              <p>Abre um, copia o link e envia. Cada link vai direto para o bilhete dessa pessoa.</p>
            </div>
            <div class="pill">DATE ${TRIP.dateLabel}</div>
          </div>

          <div class="gridHub">${cards}</div>
        </div>
      `;
    }

    function getPassengerFromQuery(){
      const sp = new URLSearchParams(location.search);
      const id = sp.get("p");
      if(!id) return null;
      return PASSENGERS.find(x => x.id === id) || null;
    }

    function updateProgress(){
      const total = TRIP.itinerary.length;
      const done = app.querySelectorAll(".stop.done").length;
      const pct = Math.round((done/total)*100);
      $("#barFill").style.width = pct + "%";
      $("#progTxt").textContent = `${done}/${total}`;

      if(done === total){
        // easter egg
        eggText.textContent = TRIP.easterEgg;
        modalBack.style.display = "flex";
        showToast("Miss√£o completa ‚úÖ");
      }
    }

    function closeModal(){
      modalBack.style.display = "none";
    }

    closeEgg.addEventListener("click", closeModal);
    modalBack.addEventListener("click", (e)=>{
      if(e.target === modalBack) closeModal();
    });

    shareEgg.addEventListener("click", async ()=>{
      const text = TRIP.easterEgg;
      try{
        if(navigator.share){
          await navigator.share({ title:"Prenda desbloqueada", text });
        }else{
          await navigator.clipboard.writeText(text);
          showToast("Frase copiada ‚úÖ");
        }
      }catch(e){}
    });

    function wirePass(p){
      let started = false;

      const btn = $("#btnCheckIn");
      const barcode = $("#barcode");
      const box = $("#checkinBox");
      const pill = $("#statusPill");

      // Initially: all steps are sealed and unusable until check-in
      app.querySelectorAll(".stop").forEach(el=>{
        el.dataset.started = "0";
      });

      btn.addEventListener("click", ()=>{
        if(started) return;

        barcode.classList.remove("scanning");
        void barcode.offsetWidth;
        barcode.classList.add("scanning");

        pill.textContent = "SCANNING";
        pill.classList.remove("wait");
        pill.style.borderColor = "rgba(0,229,255,.28)";
        pill.style.color = "rgba(0,229,255,.90)";

        setTimeout(()=>{
          started = true;
          box.classList.add("checked");
          pill.textContent = "CHECKED-IN";
          pill.classList.add("ok");
          pill.style.borderColor = "rgba(51,255,153,.26)";
          pill.style.color = "rgba(51,255,153,.90)";

          btn.disabled = true;
          btn.textContent = "CHECK-IN FEITO ‚úÖ";
          try{ navigator.vibrate?.(18); }catch(e){}
          showToast("Miss√£o iniciada. Agora revela os passos üòâ");
        }, 850);
      });

      // Reveal per step
      app.querySelectorAll("[data-reveal-btn]").forEach(btnReveal=>{
        btnReveal.addEventListener("click", (e)=>{
          e.stopPropagation();

          if(!started){
            showToast("Primeiro faz CHECK-IN üòÑ");
            return;
          }

          const stop = btnReveal.closest(".stop");
          stop.classList.remove("lockedStep");

          // remove overlay
          const overlay = stop.querySelector("[data-reveal]");
          overlay.remove();

          showToast("Passo revelado ‚úÖ");
          try{ navigator.vibrate?.(10); }catch(e){}
        });
      });

      // Open map only when revealed
      app.querySelectorAll("[data-open]").forEach(btnOpen=>{
        btnOpen.addEventListener("click", (e)=>{
          e.stopPropagation();
          const stop = btnOpen.closest(".stop");

          if(!started){
            showToast("Primeiro faz CHECK-IN üòÑ");
            return;
          }
          if(stop.classList.contains("lockedStep")){
            showToast("Revela este passo primeiro üòâ");
            return;
          }

          // mark done + open
          stop.classList.add("done");
          updateProgress();

          const url = stop.getAttribute("data-url");
          window.open(url, "_blank", "noopener");
        });
      });

      // Copy link
      $("#btnCopyLink").addEventListener("click", async ()=>{
        const base = location.origin + location.pathname;
        const link = `${base}?p=${encodeURIComponent(p.id)}`;
        try{
          await navigator.clipboard.writeText(link);
          showToast("Link copiado ‚úÖ");
        }catch(e){
          showToast("N√£o deu para copiar (browser).");
        }
      });

      updateProgress();
    }

    function wireHub(){
      app.querySelectorAll("[data-copy]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const link = btn.getAttribute("data-copy");
          try{ await navigator.clipboard.writeText(link); showToast("Link copiado ‚úÖ"); }
          catch(e){ showToast("N√£o deu para copiar (browser)."); }
        });
      });
      app.querySelectorAll("[data-open]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const link = btn.getAttribute("data-open");
          window.open(link, "_blank", "noopener");
        });
      });
    }

    // Render
    const passenger = getPassengerFromQuery();
    if(passenger){
      app.innerHTML = passView(passenger);
      wirePass(passenger);
    }else{
      app.innerHTML = hubView();
      wireHub();
    }
  </script>
</body>
</html>
